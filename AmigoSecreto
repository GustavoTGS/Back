#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <time.h>

#define limparTela system("clear")
#define separador "------------------------------------- \n"

typedef struct Participante {
    char nome[255];
    bool escolhido1; 
    bool escolhido2;
    struct Participante *dupla;
} Participante_t;

int main() {  
    FILE *pas;
    char arquivoSaida [] = "sorteados.txt";
    pas = fopen("sorteados.txt", "w");
    const int maximo = 20;
    int qtdParticipantes = 0;
    int posicao = 0;
    int posicaoSorteio = 0;
    Participante_t participantes[maximo];
    srand((unsigned) time(NULL));
    limparTela;
  
    do {
        printf("Quantidade de participantes (SO FUNCIONA Nº PAR) [ Máximo: %i ]: ", maximo);
        scanf(" %i", &qtdParticipantes);
    } while (qtdParticipantes <= 0 || qtdParticipantes % 2 != 0 || qtdParticipantes > maximo);
    limparTela;
    for (int i = 0; i < qtdParticipantes; ++i) {
        printf(separador);
        printf("Participante [ %i de %i ] \n", (i + 1), qtdParticipantes);
        printf("Nome: ");
        scanf(" %[^\n]s", participantes[posicao].nome);
        participantes[posicao].escolhido1 = false;
        participantes[posicao].escolhido2 = false;
        participantes[posicao].dupla = NULL;
        printf(separador);
        posicao++;
    }

    for (int i = 0; i < qtdParticipantes; ++i) {
        if (participantes[i].escolhido1 && participantes[i].escolhido2) {
            continue;
        }
        do {
            posicaoSorteio = rand() % posicao;
        } while (posicaoSorteio == i || participantes[posicaoSorteio].escolhido2);
        participantes[i].dupla = &participantes[posicaoSorteio];
        fprintf(pas,"%d %s ",i, participantes[i].nome);
        fprintf(pas," tirou %s;\n",participantes[i].dupla);
        participantes[i].escolhido1 = true;
        participantes[posicaoSorteio].escolhido2 = true;
    }

    limparTela;
    printf(separador);/*
    for (int i = 0; i < qtdParticipantes; ++i) {
        printf("%15s fez dupla com %s \n", participantes[i].nome, participantes[i].dupla->nome);
    }
    printf(separador);*/
    
    return 0;
}
